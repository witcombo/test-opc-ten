<?xml version="1.0" encoding="UTF-8"?>

<configuration scan="true" scanPeriod="30 seconds" >

    <!--定义日志文件的存储地址 勿在LogBack的配置中使用相对路径-->

    <property name="LOG_HOME" value="/data/logs/dispatcher"/>

    <property name="encoding" value="UTF-8"/>

    <!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度；%M:%L是方法和行号；%msg是日志消息；%n是换行符-->

    <property name="normal-pattern" value="%d{yyyy-MM-dd.HH:mm:ss} %-5level [%thread] %logger{50}.%M:%L - %msg%n"/>

    <property name="plain-pattern" value="%d{yyyy-MM-dd.HH:mm:ss} %msg%n"/>

    <property name="vipkid-pattern" value="%d{yyyy-MM-dd/HH:mm:ss.SSS}|%X{localIp}|%X{requestId}|%X{requestSeq}|^_^|class_method:%class{0}_%method|roomId:%X{_P_roomId}|userId:%X{_P_userId}|userRole:%X{_P_userRole}|line:%X{_P_line}|vendor:%X{_P_vendor}|scheduledDateTime:%X{_P_scheduledDateTime}|token:%X{_P_token}|product:%X{_P_product}|^_^|[%t] %-5level %logger{50} %line - %m%n"/>

    <!-- 按照每天生成日志文件 -->

    <appender name="INFO" class="ch.qos.logback.core.rolling.RollingFileAppender">

        <!--日志文件输出的文件名-->

        <file>${LOG_HOME}/l-sgplm-qbench-gzhs-1.cls.dev.ten.dm.log</file>

        <Append>true</Append>

        <prudent>false</prudent>

        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">

            <!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符-->

            <pattern>${vipkid-pattern}</pattern>

        </encoder>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">

            <!--归档日志文件名-->

            <FileNamePattern>${LOG_HOME}/l-sgplm-qbench-gzhs-1.cls.dev.ten.dm.log.%d{yyyy-MM-dd}</FileNamePattern>

            <!--日志文件保留个数-->

            <maxHistory>32</maxHistory>

        </rollingPolicy>

    </appender>



    <appender name="STDOUT"  class="ch.qos.logback.core.ConsoleAppender">

        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">

            <level>INFO</level>

        </filter>

        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">

            <pattern>${vipkid-pattern}</pattern>

        </encoder>

    </appender>



    <!-- log file error -->

    <appender name="ERROR"

              class="ch.qos.logback.core.rolling.RollingFileAppender">

        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">

            <level>ERROR</level>

        </filter>

        <file>${LOG_HOME}/l-sgplm-qbench-gzhs-1.cls.dev.ten.dm-error.log</file>

        <prudent>false</prudent>

        <Append>true</Append>

        <encoder>

            <pattern>${vipkid-pattern}</pattern>

            <charset>${encoding}</charset>

        </encoder>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">

            <fileNamePattern>${LOG_HOME}/l-sgplm-qbench-gzhs-1.cls.dev.ten.dm-error.log.%d{yyyy-MM-dd}</fileNamePattern>

            <maxHistory>30</maxHistory>

        </rollingPolicy>

    </appender>



    <appender name="ASYNC" class="ch.qos.logback.classic.AsyncAppender">

        <!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 -->

        <discardingThreshold>0</discardingThreshold>

        <!-- 更改默认的队列的深度,该值会影响性能.默认值为256 -->

        <queueSize>102400</queueSize>

        <includeCallerData>true</includeCallerData>

        <neverBlock>true</neverBlock>

        <!-- 添加附加的appender,最多只能添加一个 -->

        <appender-ref ref="INFO"/>

    </appender>



    <root level="info">

        <appender-ref ref="ASYNC"/>

        <appender-ref ref="ERROR"/>

    </root>

    <!--//TODO 添加异常类记录基本的异常日志输出-->

    <logger name="org.springframework" level="error"/>

    <logger name="io.netty" level="error"/>

</configuration>
